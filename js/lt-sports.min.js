var timeoutNoti,apiConfig={USER_SERVICE:location.origin+"/UserService.aspx",LOTTERY_SERVICE:location.origin+"/LotteryService.aspx"};function toQueryPair(e,n){return void 0===n?e:e+"="+encodeURIComponent(null===n?"":String(n))}function toBodyString(e){var n=[];for(var t in e){var a=e[t];if(a&&a.constructor===Array){for(var r,o=[],l=0,i=a.length;l<i;l++)r=a[l],o.push(toQueryPair(t+"[]",r));n=n.concat(o)}else n.push(toQueryPair(t,a))}return n.join("&")}function requestHTTP(r,e){r=r||{};var o=e||"";return new Promise(function(e,n){var t=toBodyString(r),a=new window.XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?e(JSON.parse(a.responseText)):n(a))},a.send(t)})}function getBalanceTransfer(e){document.querySelectorAll("#transferMoney").length&&CheckUserBalanceThirdParty(e)}function CheckUserBalanceThirdParty(e){var n={msgMain:"",balanceMain:Number(e).toFixed(0),msgIBC:"",balanceIBC:0,msgHABA:"",balanceHABA:0,msgEBET:"",balanceEBET:0};document.getElementById("transferMoneyInner").style.display="block",requestHTTP({flag:"ibcCheckUserBalance"},apiConfig.USER_SERVICE).then(function(e){if(!e.msg||""===e.msg)return"maintain"===e.message?n.msgIBC="Đang bảo trì":""!==e.message?n.msgIBC=e.message:n.balanceIBC=(1e3*Number(e.balance)).toFixed(0),requestHTTP({flag:"habaCheckUserBalance"},apiConfig.USER_SERVICE);showErrorAlert("Vui lòng đăng nhập lại",2e3)}).then(function(e){if(!e.msg||""===e.msg)return""!==e.message?n.msgHABA=e.message:n.balanceHABA=Number(e.balance).toFixed(0),requestHTTP({flag:"ebetUserInfor"},location.origin+"/UserService.aspx");showErrorAlert("Vui lòng đăng nhập lại",2e3)}).then(function(e){""!==e.message?n.msgEBET=e.message:n.balanceEBET=(1e3*Number(e.balance)).toFixed(0),calcTotalBalance(n)}).catch(function(e){console.log(e)})}function calcTotalBalance(e){var n=document.getElementById("balanceMain"),t=document.getElementById("balanceSport"),a=document.getElementById("balanceHaba"),r=document.getElementById("balanceLiveCasino"),o=document.getElementById("totalMoneyHave"),l=document.getElementById("ebalance");""!==e.msgMain?n.innerHTML=e.msgMain:(n.innerHTML=numberWithCommas(e.balanceMain),l.innerHTML=numberWithCommas(e.balanceMain)),""!==e.msgIBC?t.innerHTML=e.msgIBC:t.innerHTML=numberWithCommas(e.balanceIBC),""!==e.msgHABA?a.innerHTML=e.msgHABA:a.innerHTML=numberWithCommas(e.balanceHABA),""!==e.msgEBET?r.innerHTML=e.msgEBET:r.innerHTML=numberWithCommas(e.balanceEBET),console.log(e.balanceMain),console.log(e.balanceIBC),console.log(e.balanceHABA),console.log(e.balanceEBET),o.innerHTML=numberWithCommas(Number(e.balanceMain)+Number(e.balanceIBC)+Number(e.balanceHABA)+Number(e.balanceEBET))}function transferToFormAccount(){var n=document.getElementById("fromToAccount"),t=document.querySelector(".noteTransfer"),a=document.getElementById("typeGameBet");document.getElementById("toAccountFrom").addEventListener("change",function(e){e.preventDefault(),1===Number(e.target.value)?(n.innerHTML='<option value="1">Cược thể thao</option><option value="2">Trò Chơi</option><option value="3">Live Casino eBET</option>',a.innerHTML="Thể Thao",t.style.display="block"):0===Number(e.target.value)||2===Number(e.target.value)?(n.innerHTML='<option value="0">Tài khoản chính</option>',t.style.display="none"):3===Number(e.target.value)&&(t.style.display="none",n.innerHTML='<option value="0">Tài khoản chính</option>')}),n.addEventListener("change",function(e){2===Number(e.target.value)?t.style.display="none":1===Number(e.target.value)?(t.style.display="block",a.innerHTML="Thể Thao"):3===Number(e.target.value)&&(t.style.display="block",a.innerHTML="Live Casino eBet")});var e=document.createEvent("Events");e.initEvent("change",!0,!1),document.getElementById("toAccountFrom").dispatchEvent(e),document.getElementById("valTransferMoney").addEventListener("keyup",function(e){e.preventDefault();var n=e.target.value.replace(/[,]/g,"");e.target.value=numberWithCommas(Number(n))}),document.getElementById("btnSubmitTransferMoney").removeEventListener("click",transferSubmit),document.getElementById("btnSubmitTransferMoney").addEventListener("click",transferSubmit)}function transferSubmit(n){n.preventDefault();var e=document.getElementById("fromToAccount"),t=document.getElementById("toAccountFrom"),a=document.getElementById("valTransferMoney").value;if(""===a||/[^0-9,]/g.test(a))showErrorAlert("Số tiền không hợp lệ !!!",2e3);else if(Number(a)<1e3)showErrorAlert("Số tiền ít nhất là 1,000 vnđ !!!",2e3);else if(!n.target.classList.contains("activeSubmit")){n.target.classList.add("activeSubmit");var r={direction:e.value,amount:Number(a.replace(/[,]/g,""))/1e3};"1"===e.value&&"1"===t.value||"0"===e.value&&"0"===t.value?r.flag="ibcFundTransfer":"2"===e.value&&"1"===t.value?r.flag="habaFundTransferDeposit":"0"===e.value&&"2"===t.value?r.flag="habaFundTransferWithdraw":"3"===e.value&&"1"===t.value?r.flag="ebetFundTransferDeposit":"3"===t.value&&"0"===e.value&&(r.flag="ebetFundTransferWithdraw"),dotLoading(!1),requestHTTP(r,apiConfig.USER_SERVICE).then(function(e){""!==e.message?dotLoading(!0,e.message,0):dotLoading(!0,"Giao dịch thành công",1),getBalanceMain(),document.getElementById("valTransferMoney").value="",n.target.classList.remove("activeSubmit")})}}function dotLoading(e,n,t){clearTimeout(timeoutNoti);var a,r=document.getElementById("noteTransfer"),o=".",l=0;r.innerHTML='Đang xác nhận<span class="dotLoading"></span>',r.style.display="inline-block",a=document.querySelector(".dotLoading");var i=setInterval(function(){a.innerHTML=o,o+=".",4===(l+=1)&&(o=".",l=0),e&&(t?r.classList.add("successTransfer"):r.classList.add("errorTransfer"),r.innerHTML=n,clearInterval(i),timeoutNoti=setTimeout(function(){r.innerHTML="",r.classList.remove("successTransfer","errorTransfer")},2500))},150)}function toggleBtnTryPlay(e){if(!Number(e)){var n=location.pathname,t=document.querySelector(".btnTryPlay");-1<n.search("/sport.shtml")?t.style.display="none":t.style.display="flex"}}function getBalanceMain(){requestHTTP({flag:"balance"},apiConfig.LOTTERY_SERVICE).then(function(e){var n=Number(e.balance);getBalanceTransfer(n=Math.round(n))})}$(document).ready(function(){toggleBtnTryPlay(document.getElementById("flagLogin").value)}),window.addEventListener?window.addEventListener("load",function(){var e=document.getElementById("flagLogin").value;Number(e)||0===document.querySelectorAll("#transferMoney").length||(getBalanceMain(),transferToFormAccount())},!1):window.attachEvents&&window.attachEvents("onload",function(){var e=document.getElementById("flagLogin").value;Number(e)||0===document.querySelectorAll("#transferMoney").length||(getBalanceMain(),transferToFormAccount())});